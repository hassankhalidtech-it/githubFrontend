<mat-toolbar color="primary" class="toolbar">
    <span class="toolbar-title">GitHub Integration</span>
    <span class="toolbar-spacer"></span>

    <div class="connection-status">
        <span class="status-dot" [ngClass]="status ? 'online' : 'offline'">
        </span>

        <span class="status-text">
            {{ status ? 'Connected' : 'Disconnected' }}
        </span>

        <span class="status-date" *ngIf="connectedAt">
            ({{ connectedAt | date:'MMM d, y — h:mm:ss a' }})
        </span>
    </div>

    <button mat-icon-button [matMenuTriggerFor]="menu">
        <mat-icon>more_vert</mat-icon>
    </button>

    <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="sync()">
            <mat-icon>sync</mat-icon>
            <span>Sync Integration</span>
        </button>

        <button mat-menu-item (click)="logout()">
            <mat-icon color="warn">delete</mat-icon>
            <span>Remove Integration</span>
        </button>
    </mat-menu>
</mat-toolbar>




<div class="container">
    <div *ngIf="isLoading" class="loading-shade">
        <mat-spinner></mat-spinner>
    </div>

    <div *ngIf="error" class="error-message">
        {{ error }}
    </div>

    <!-- *ngIf="!isLoading && !error && dataSource.data.length > 0" -->
    <div class="table-container mat-elevation-z8">
        <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Search</mat-label>
            <input matInput (keyup)="applyFilter($event)" placeholder="Search in table">
        </mat-form-field>

        <div class="inline-filters">
            <div style="flex-grow: 1;">
                <h4>Active Integrations</h4>
                <mat-form-field style="width: 100%;">
                    <mat-label>Select a value</mat-label>
                    <mat-select value="github">
                        <mat-option>Select a value</mat-option>
                        @for (platform of active_integration; track platform) {
                        <mat-option [value]="platform.value">{{platform.label}}</mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            </div>

            <div style="flex-grow: 1;">
                <h4>Entity</h4>
                <mat-form-field style="width: 100%;">
                    <mat-label>Select an entity</mat-label>
                    <mat-select (selectionChange)="getInfo($event.value)">
                        <mat-option>Select an entity</mat-option>
                        @for (entity of entities; track entity) {
                        <mat-option [value]="entity.value">{{entity.label}}</mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            </div>

            <div style="flex-grow: 1;">
                <h4>Processed Entity</h4>
                <mat-form-field style="width: 100%;">
                    <mat-label>Select an entity</mat-label>
                    <mat-select>
                        <mat-option>Select an entity</mat-option>
                        @for (processed_entity of processed_entities; track processed_entity) {
                        <mat-option [value]="processed_entity.value">{{processed_entity.label}}</mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            </div>


        </div>

        <div class="table-wrapper">
            <table mat-table [dataSource]="data" class="mat-elevation-z8 full-width-table">
                <!-- Dynamic columns -->
                <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
                    <th mat-header-cell *matHeaderCellDef (click)="sortData(column)" class="sortable">
                        {{ column | titlecase }}
                        <span *ngIf="sortModel[0]?.colId === column">
                            {{ sortModel[0].sort === 'asc' ? '▲' : '▼' }}
                        </span>
                    </th>
                    <td mat-cell *matCellDef="let element">
                        {{ column.includes('.') ? getNestedValue(element, column) : element[column] }}
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
        </div>

        <mat-paginator [length]="totalRows" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions"
            (page)="pageChanged($event)" showFirstLastButtons></mat-paginator>
    </div>
</div>